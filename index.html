<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaxiRechner">

    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mietwagen-Preisrechner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2ff;
            padding-top: 250px;
        }
        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 45px;
        }
        .input-style {
            transition: all 0.2s;
            border-color: #e5e7eb;
            background-color: #f9fafb;
        }
        .input-style:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(165, 180, 252, 0.5);
        }
        .sticky-header {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 512px;
            z-index: 100;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .hidden-transition {
            transition: opacity 0.3s ease-in-out, max-height 0.5s ease-in-out;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            margin-top: 0;
        }
        .visible-transition {
            opacity: 1;
            max-height: 200px;
            margin-top: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #4f46e5; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-lg sticky-header bg-indigo-700 p-5 md:p-6">
        <h2 class="text-sm font-semibold text-indigo-300 mb-1 uppercase tracking-wider">Ihr aktueller Fahrpreis:</h2>
        <div class="flex justify-between items-end">
            <span id="totalFare" class="text-5xl font-extrabold text-green-300">18,50 ‚Ç¨</span>
            <span class="text-3xl font-bold text-white">Gesamt</span>
        </div>
    </div><br><br><br>

    <div class="w-full max-w-lg card bg-white rounded-xl p-6 md:p-8">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">Preisdetails eingeben</h1>
        <p class="text-gray-500 mb-8 border-b pb-4">Geben Sie Ihre Fahrtparameter ein, um die Gesamtkosten zu berechnen.</p>

        <div class="space-y-6">

            <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg border border-indigo-100">
                <span class="text-base font-bold text-indigo-900">Liegendtransport</span>
                <label class="switch">
                    <input type="checkbox" id="isLying" onchange="calculateFare()">
                    <span class="slider"></span>
                </label>
            </div>

            <div>
                <label for="distanceKm" class="block text-sm font-semibold text-gray-700 mb-1">
                    Fahrstrecke (km)
                </label>
                <input type="number" id="distanceKm" min="0" step="0.1"
                        placeholder="Bitte km eingeben"
                        oninput="calculateFare()"
                        class="input-style w-full p-3 border rounded-lg text-lg focus:outline-none"
                        aria-label="Fahrstrecke in Kilometern"
                        autocomplete="off"
                        value="">
            </div>

            <div>
                <label for="waitingMinutes" class="block text-sm font-semibold text-gray-700 mb-1">
                    Stand-/Wartezeit (Minuten)
                </label>
                <input type="number" id="waitingMinutes" min="0" step="1"
                        placeholder="Wartezeit in Minuten eingeben"
                        oninput="calculateFare()"
                        class="input-style w-full p-3 border rounded-lg text-lg focus:outline-none"
                        aria-label="Wartezeit in Minuten"
                        autocomplete="off"
                        value="">
            </div>

            <div>
                <label for="arrivalSurcharge" class="block text-sm font-semibold text-gray-700 mb-1">
                    Anfahrtspauschale
                </label>
                <select id="arrivalSurcharge" onchange="calculateFare()"
                        class="input-style w-full p-3 border rounded-lg text-lg focus:outline-none appearance-none bg-white pr-8"
                        aria-label="Anfahrtskosten ausw√§hlen">
                    <option value="0.00">Anfahrtskosten ausw√§hlen</option>
                    <option value="5.00">5,00 ‚Ç¨</option>
                    <option value="10.00">10,00 ‚Ç¨</option>
                    <option value="15.00">15,00 ‚Ç¨</option>
                    <option value="20.00">20,00 ‚Ç¨</option>
                    <option value="25.00">25,00 ‚Ç¨</option>
                    <option value="30.00">30,00 ‚Ç¨</option>
                    <option value="40.00">40,00 ‚Ç¨</option>
                    <option value="50.00">50,00 ‚Ç¨</option>
                </select>
            </div>


            <div class="space-y-4 pt-2 pb-4 border-t border-b">
                <p class="text-sm font-semibold text-gray-700">Optionale Zuschl√§ge:</p>

                <div class="flex items-center">
                    <input id="isNight" type="checkbox" onchange="calculateFare()"
                            class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                            aria-label="Nachtzuschlag aktivieren">
                    <label for="isNight" class="ml-3 text-base font-medium text-gray-700">
                        Nachtfahrt (22:00 - 06:00 Uhr)
                    </label>
                </div>

                <div class="flex items-center">
                    <input id="isSmallLuggage" type="checkbox" onchange="calculateFare()"
                            class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                            aria-label="Kleiner Gep√§ckzuschlag aktivieren">
                    <label for="isSmallLuggage" class="ml-3 text-base font-medium text-gray-700">
                        Gep√§ck klein (15,00 ‚Ç¨)
                    </label>
                </div>

                <div class="flex items-center">
                    <input id="isLargeLuggage" type="checkbox" onchange="calculateFare()"
                            class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                            aria-label="Gro√üer Gep√§ckzuschlag aktivieren">
                    <label for="isLargeLuggage" class="ml-3 text-base font-medium text-gray-700">
                        Gep√§ck gro√ü (30,00 ‚Ç¨)
                    </label>
                </div>
                <div class="flex items-center">
                    <input id="isCarryChair" type="checkbox" onchange="toggleCarryChairOptions(); calculateFare();"
                            class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                            aria-label="Tragestuhlzuschlag aktivieren">
                    <label for="isCarryChair" class="ml-3 text-base font-medium text-gray-700">
                        Tragestuhlzuschlag (Spezialtransport)
                    </label>
                </div>

                <div id="carryChairOptions" class="hidden-transition space-y-4 pl-6 border-l-4 border-indigo-300 bg-indigo-50 p-3 rounded-lg">

                    <div>
                        <label for="stairCount" class="block text-sm font-semibold text-gray-700 mb-1">
                            Anzahl Treppen (jeweils 12,00 ‚Ç¨)
                        </label>
                        <input type="number" id="stairCount" min="0" step="1"
                                placeholder="Anzahl der Treppen eingeben"
                                oninput="calculateFare()"
                                class="input-style w-full p-3 border rounded-lg text-lg focus:outline-none"
                                autocomplete="off"
                                value="">
                    </div>

                    <div class="flex items-center">
                        <input id="isCompanyWheelchair" type="checkbox" onchange="calculateFare()"
                                class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                                aria-label="Firmenrollstuhlzuschlag aktivieren">
                        <label for="isCompanyWheelchair" class="ml-3 text-base font-medium text-gray-700">
                            Firmenrollstuhl (12,00 ‚Ç¨)
                        </label>
                    </div>

                    <div class="flex items-center">
                        <input id="isStairClimber" type="checkbox" onchange="calculateFare()"
                                class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                                aria-label="Treppenraupezuschlag aktivieren">
                        <label for="isStairClimber" class="ml-3 text-base font-medium text-gray-700">
                            Treppenraupe (30,00 ‚Ç¨)
                        </label>
                    </div>
                </div>

            </div>

             <button onclick="resetInputs()"
                    class="w-full bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-150 ease-in-out">
                Eingaben l√∂schen üóëÔ∏è
            </button>

            <button onclick="shareViaWhatsapp()"
                    class="w-full bg-green-500 text-white p-3 rounded-lg font-semibold hover:bg-green-600 transition duration-150 ease-in-out">
                Per WhatsApp teilen (Name wird abgefragt) üì≤
            </button>
        </div>

        <div class="mt-8 border-t pt-6 bg-gray-50 p-4 rounded-lg">
            <h3 class="text-xl font-extrabold text-gray-800 mb-4 border-b pb-2">Kosten-Aufschl√ºsselung</h3>
            <div class="space-y-3 text-base">
                <div class="flex justify-between text-gray-600">
                    <span>Grundgeb√ºhr (18,50 ‚Ç¨):</span>
                    <span id="detailBaseFare" class="font-medium text-gray-800">18,50 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span>Distanzkosten (<span id="kmRateDisplay">2,50</span> ‚Ç¨/km):</span>
                    <span id="detailDistanceCost" class="font-medium text-gray-800">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span>Wartezeitkosten (0,75 ‚Ç¨/Min):</span>
                    <span id="detailWaitingCost" class="font-medium text-gray-800">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600 border-t pt-3 mt-3 border-dashed">
                    <span class="text-sm text-indigo-600 font-semibold" id="lyingLabel" style="display:none;">Liegendtransport aktiviert (5,00 ‚Ç¨/km)</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Anfahrtspauschale:</span>
                    <span id="detailArrivalSurcharge" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Nachtzuschlag (1,50 ‚Ç¨):</span>
                    <span id="detailNightSurcharge" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Gep√§ck klein (15,00 ‚Ç¨):</span>
                    <span id="detailSmallLuggage" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Gep√§ck gro√ü (30,00 ‚Ç¨):</span>
                    <span id="detailLargeLuggage" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Treppenkosten (<span id="stairCountDisplay">0</span> x 12,00 ‚Ç¨):</span>
                    <span id="detailStairCost" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Firmenrollstuhl (12,00 ‚Ç¨):</span>
                    <span id="detailCompanyWheelchair" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>
                <div class="flex justify-between text-gray-600">
                    <span class="text-sm">Treppenraupe (30,00 ‚Ç¨):</span>
                    <span id="detailStairClimber" class="font-medium text-red-500">0,00 ‚Ç¨</span>
                </div>

                <div class="flex justify-between font-extrabold text-2xl text-indigo-700 pt-4 border-t mt-4">
                    <span>SUMME:</span>
                    <span id="detailTotalSum">18,50 ‚Ç¨</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const TARIFFS = {
            BASE_FARE: 18.50,
            DISTANCE_RATE_NORMAL: 2.50,
            DISTANCE_RATE_LYING: 5.00,
            NIGHT_SURCHARGE: 1.50,
            WAITING_RATE_PER_MINUTE: 0.75,
            STAIR_RATE_PER_STEP: 12.00,
            COMPANY_WHEELCHAIR_SURCHARGE: 12.00,
            STAIR_CLIMBER_SURCHARGE: 30.00,
            SMALL_LUGGAGE_SURCHARGE: 15.00,
            LARGE_LUGGAGE_SURCHARGE: 30.00
        };

        function formatCurrency(amount) {
            return amount.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' });
        }

        function toggleCarryChairOptions() {
            const isCarryChair = document.getElementById('isCarryChair').checked;
            const optionsDiv = document.getElementById('carryChairOptions');
            if (isCarryChair) {
                optionsDiv.classList.remove('hidden-transition');
                optionsDiv.classList.add('visible-transition');
            } else {
                optionsDiv.classList.remove('visible-transition');
                optionsDiv.classList.add('hidden-transition');
                document.getElementById('stairCount').value = '';
                document.getElementById('isCompanyWheelchair').checked = false;
                document.getElementById('isStairClimber').checked = false;
            }
        }

        function calculateFare() {
            const isLying = document.getElementById('isLying').checked;
            const distanceInput = document.getElementById('distanceKm');
            const waitingInput = document.getElementById('waitingMinutes');
            const nightCheckbox = document.getElementById('isNight');
            const arrivalSelect = document.getElementById('arrivalSurcharge');
            const smallLuggageCheckbox = document.getElementById('isSmallLuggage');
            const largeLuggageCheckbox = document.getElementById('isLargeLuggage');
            const carryChairCheckbox = document.getElementById('isCarryChair');
            const stairCountInput = document.getElementById('stairCount');
            const companyWheelchairCheckbox = document.getElementById('isCompanyWheelchair');
            const stairClimberCheckbox = document.getElementById('isStairClimber');

            const distanceKm = Math.max(0, parseFloat(distanceInput.value) || 0);
            const waitingMinutes = Math.max(0, parseInt(waitingInput.value, 10) || 0);
            const arrivalSurchargeCost = parseFloat(arrivalSelect.value) || 0;
            const stairCount = carryChairCheckbox.checked ? Math.max(0, parseInt(stairCountInput.value, 10) || 0) : 0;

            const currentKmRate = isLying ? TARIFFS.DISTANCE_RATE_LYING : TARIFFS.DISTANCE_RATE_NORMAL;

            document.getElementById('kmRateDisplay').textContent = currentKmRate.toLocaleString('de-DE', {minimumFractionDigits: 2});
            document.getElementById('lyingLabel').style.display = isLying ? 'block' : 'none';

            let distanceCost = distanceKm * currentKmRate;
            let waitingCost = waitingMinutes * TARIFFS.WAITING_RATE_PER_MINUTE;
            let nightSurcharge = nightCheckbox.checked ? TARIFFS.NIGHT_SURCHARGE : 0;
            let smallLuggageCost = smallLuggageCheckbox.checked ? TARIFFS.SMALL_LUGGAGE_SURCHARGE : 0;
            let largeLuggageCost = largeLuggageCheckbox.checked ? TARIFFS.LARGE_LUGGAGE_SURCHARGE : 0;
            
            let stairCost = 0;
            let companyWheelchairCost = 0;
            let stairClimberCost = 0;

            if (carryChairCheckbox.checked) {
                stairCost = stairCount * TARIFFS.STAIR_RATE_PER_STEP;
                if (companyWheelchairCheckbox.checked) companyWheelchairCost = TARIFFS.COMPANY_WHEELCHAIR_SURCHARGE;
                if (stairClimberCheckbox.checked) stairClimberCost = TARIFFS.STAIR_CLIMBER_SURCHARGE;
            }

            let totalFare = TARIFFS.BASE_FARE + distanceCost + waitingCost + arrivalSurchargeCost + nightSurcharge + smallLuggageCost + largeLuggageCost + stairCost + companyWheelchairCost + stairClimberCost;
            totalFare = Math.round(totalFare * 100) / 100;

            document.getElementById('totalFare').textContent = formatCurrency(totalFare);
            document.getElementById('detailBaseFare').textContent = formatCurrency(TARIFFS.BASE_FARE);
            document.getElementById('detailDistanceCost').textContent = formatCurrency(distanceCost);
            document.getElementById('detailWaitingCost').textContent = formatCurrency(waitingCost);
            document.getElementById('detailArrivalSurcharge').textContent = formatCurrency(arrivalSurchargeCost);
            document.getElementById('detailNightSurcharge').textContent = formatCurrency(nightSurcharge);
            document.getElementById('detailSmallLuggage').textContent = formatCurrency(smallLuggageCost);
            document.getElementById('detailLargeLuggage').textContent = formatCurrency(largeLuggageCost);
            document.getElementById('stairCountDisplay').textContent = stairCount;
            document.getElementById('detailStairCost').textContent = formatCurrency(stairCost);
            document.getElementById('detailCompanyWheelchair').textContent = formatCurrency(companyWheelchairCost);
            document.getElementById('detailStairClimber').textContent = formatCurrency(stairClimberCost);
            document.getElementById('detailTotalSum').textContent = formatCurrency(totalFare);
        }

        function resetInputs() {
            document.getElementById('isLying').checked = false;
            document.getElementById('distanceKm').value = '';
            document.getElementById('waitingMinutes').value = '';
            document.getElementById('isNight').checked = false;
            document.getElementById('arrivalSurcharge').value = '0.00';
            document.getElementById('isSmallLuggage').checked = false;
            document.getElementById('isLargeLuggage').checked = false;
            document.getElementById('isCarryChair').checked = false;
            toggleCarryChairOptions();
            calculateFare();
        }

        function shareViaWhatsapp() {
            const totalFareText = document.getElementById('totalFare').textContent;
            const passengerName = prompt("Bitte geben Sie den Namen des Fahrgastes ein:");
            if (!passengerName) return;

            const isLying = document.getElementById('isLying').checked;
            const distanceKm = parseFloat(document.getElementById('distanceKm').value) || 0;
            const currentKmRate = isLying ? TARIFFS.DISTANCE_RATE_LYING : TARIFFS.DISTANCE_RATE_NORMAL;

            let message = `Fahrt von ${passengerName} kostet ${totalFareText}.\n\n`;
            message += `DETAILS:\n`;
            message += `Grundgeb√ºhr: ${formatCurrency(TARIFFS.BASE_FARE)}\n`;
            if (isLying) message += `Art: LIEGENDTRANSPORT (5,00 ‚Ç¨/km)\n`;
            if (distanceKm > 0) message += `Distanz (${distanceKm} km √† ${formatCurrency(currentKmRate)}/km): ${formatCurrency(distanceKm * currentKmRate)}\n`;
            
            const waitMin = parseInt(document.getElementById('waitingMinutes').value, 10) || 0;
            if (waitMin > 0) message += `Wartezeit: ${formatCurrency(waitMin * TARIFFS.WAITING_RATE_PER_MINUTE)}\n`;
            
            const arrSurcharge = parseFloat(document.getElementById('arrivalSurcharge').value) || 0;
            if (arrSurcharge > 0) message += `Anfahrt: ${formatCurrency(arrSurcharge)}\n`;
            
            if (document.getElementById('isNight').checked) message += `Nachtzuschlag: ${formatCurrency(TARIFFS.NIGHT_SURCHARGE)}\n`;
            if (document.getElementById('isSmallLuggage').checked) message += `Gep√§ck klein: ${formatCurrency(TARIFFS.SMALL_LUGGAGE_SURCHARGE)}\n`;
            if (document.getElementById('isLargeLuggage').checked) message += `Gep√§ck gro√ü: ${formatCurrency(TARIFFS.LARGE_LUGGAGE_SURCHARGE)}\n`;

            if (document.getElementById('isCarryChair').checked) {
                message += `--- Tragestuhl-Zuschl√§ge ---\n`;
                const sCount = parseInt(document.getElementById('stairCount').value, 10) || 0;
                if (sCount > 0) message += `Treppen (${sCount} St.): ${formatCurrency(sCount * TARIFFS.STAIR_RATE_PER_STEP)}\n`;
                if (document.getElementById('isCompanyWheelchair').checked) message += `Firmenrollstuhl: ${formatCurrency(TARIFFS.COMPANY_WHEELCHAIR_SURCHARGE)}\n`;
                if (document.getElementById('isStairClimber').checked) message += `Treppenraupe: ${formatCurrency(TARIFFS.STAIR_CLIMBER_SURCHARGE)}\n`;
            }

            message += `\nGESAMTSUMME: ${totalFareText}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }

        window.onload = function() {
            toggleCarryChairOptions();
            calculateFare();
        }
    </script>
</body>
</html>
